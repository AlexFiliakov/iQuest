/home/alexf/claude-env/lib/python3.12/site-packages/pytest_asyncio/plugin.py:208: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.3.5, pluggy-1.6.0 -- /home/alexf/claude-env/bin/python3
cachedir: .pytest_cache
Using --random-order-bucket=module
Using --random-order-seed=967057

benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
hypothesis profile 'default'
Matplotlib: 3.10.3
Freetype: 2.6.1
PyQt6 6.9.0 -- Qt runtime 6.9.0 -- Qt compiled 6.9.0
metadata: {'Python': '3.12.3', 'Platform': 'Linux-5.15.167.4-microsoft-standard-WSL2-x86_64-with-glibc2.39', 'Packages': {'pytest': '8.3.5', 'pluggy': '1.6.0'}, 'Plugins': {'random-order': '1.1.1', 'benchmark': '5.1.0', 'hypothesis': '6.131.28', 'rerunfailures': '15.1', 'anyio': '4.9.0', 'reverse': '1.8.0', 'mock': '3.14.0', 'mpl': '0.17.0', 'qt': '4.4.0', 'xdist': '3.7.0', 'Faker': '37.3.0', 'timeout': '2.4.0', 'cov': '6.1.1', 'asyncio': '1.0.0', 'html': '4.1.1', 'metadata': '3.1.1'}}
rootdir: /mnt/c/Users/alexf/OneDrive/Documents/Projects/Apple Health Exports
configfile: pytest.ini
plugins: random-order-1.1.1, benchmark-5.1.0, hypothesis-6.131.28, rerunfailures-15.1, anyio-4.9.0, reverse-1.8.0, mock-3.14.0, mpl-0.17.0, qt-4.4.0, xdist-3.7.0, Faker-37.3.0, timeout-2.4.0, cov-6.1.1, asyncio-1.0.0, html-4.1.1, metadata-3.1.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1216 items

tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_initialization PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_get_current_streak_no_streak PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestDataClasses::test_streak_info PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_detect_momentum_accelerating PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_detect_momentum_insufficient_data PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestDataClasses::test_momentum_indicator PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_linear_prediction_method PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_exponential_prediction_method PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_get_current_streak_improvement PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_predict_next_week_insufficient_data PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestDataClasses::test_prediction PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_get_trend_series PASSED [  0%]
tests/unit/test_week_over_week_trends.py::TestMomentumType::test_momentum_type_values PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_predict_next_week_linear PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_exponential_prediction_insufficient_data PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestDataClasses::test_week_trend_data PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_calculate_confidence_partial_week PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestDataClasses::test_trend_result PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_calculate_week_change_improvement PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_generate_trend_narrative_stable PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_generate_trend_narrative_improvement PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_calculate_week_change_decline PASSED [  1%]
tests/unit/test_week_over_week_trends.py::TestWeekOverWeekTrends::test_determine_trend_direction PASSED [  1%]
tests/unit/test_data_loader.py::TestDataLoader::test_file_not_found_errors PASSED [  1%]
tests/unit/test_data_loader.py::TestDataLoader::test_value_conversion PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_get_date_range PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_query_date_range PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_error_handling PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_input_validation PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_get_available_types PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_get_weekly_summary PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_get_daily_summary PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_get_monthly_summary PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_convert_xml_to_sqlite PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_validate_database PASSED [  2%]
tests/unit/test_data_loader.py::TestDataLoader::test_migrate_csv_to_sqlite PASSED [  2%]
tests/unit/test_calendar_heatmap.py::TestMouseInteraction::test_hover_interaction PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_initialization PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestSignals::test_date_clicked_signal PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_set_metric_data PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_change_color_scale PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestDataHandling::test_large_dataset PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestGitHubStyleSpecifics::test_github_style_is_default PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestMouseInteraction::test_mouse_press_release PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_change_view_mode PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestColorInterpolation::test_color_interpolation_edge_cases PASSED [  3%]
tests/unit/test_calendar_heatmap.py::TestColorInterpolation::test_color_interpolation_extremes PASSED [  3%]
tests/unit/test_calendar_heatmap.py::test_calendar_heatmap_alias PASSED  [  3%]
tests/unit/test_calendar_heatmap.py::TestDataHandling::test_data_bounds_calculation PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestDataHandling::test_single_data_point PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_animation_progress_property PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_get_color_for_value PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestGitHubStyleSpecifics::test_github_style_rendering PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_toggle_patterns PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestDataHandling::test_empty_data PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestSignals::test_view_mode_changed_signal PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_set_current_date PASSED [  4%]
tests/unit/test_calendar_heatmap.py::TestCalendarHeatmapComponent::test_color_scale_initialization PASSED [  4%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_by_criteria_parametrized[filter_criteria1-50-sourceName] PASSED [  4%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_list_filters_parametrized[filter_values0-add_source_filter-sourceName IN (?,?)] PASSED [  4%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_by_date_range PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_list_filters_parametrized[filter_values2-add_type_filter-type IN (?)] PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_list_filters_parametrized[filter_values3-add_source_filter-sourceName IN (?)] PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_by_criteria_parametrized[filter_criteria2-30-type] PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_query_with_limit PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_by_criteria_parametrized[filter_criteria3-50-type] PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_optimize_for_filters PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_get_distinct_types PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_performance_metrics PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_get_data_date_range PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_empty_filter_results PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_with_limit PASSED [  5%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_date_range_filters_parametrized[start_date1-None-creationDate >= ?-1] PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_date_range_filters_parametrized[start_date0-end_date0-BETWEEN ? AND ?-2] PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_list_filters_parametrized[filter_values1-add_type_filter-type IN (?,?)] PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_empty_query PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_performance_threshold PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_combined_filters PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_by_criteria_parametrized[filter_criteria0-30-sourceName] PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_date_range_filters_parametrized[None-end_date2-creationDate <= ?-1] PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_get_distinct_sources PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestDataFilterEngine::test_filter_all_data PASSED [  6%]
tests/unit/test_data_filter_engine.py::TestQueryBuilder::test_combined_filters PASSED [  6%]
tests/unit/test_temporal_anomaly_detector.py::TestLSTMTemporalDetector::test_lstm_detection PASSED [  6%]
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_statistical_only PASSED [  6%]
tests/unit/test_temporal_anomaly_detector.py::TestSTLAnomalyDetector::test_stl_fallback_to_iqr PASSED [  7%]
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_with_ml PASSED [  7%]
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_ensemble_weights PASSED [  7%]
tests/unit/test_temporal_anomaly_detector.py::TestSTLAnomalyDetector::test_stl_detection_basic PASSED [  7%]
tests/unit/test_temporal_anomaly_detector.py::TestTemporalAnomalyIntegration::test_integration_with_ensemble PASSED [  7%]
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_confidence_scoring PASSED [  7%]
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_save_load FAILED [  7%]

=================================== FAILURES ===================================
___________ TestHybridTemporalAnomalyDetector.test_hybrid_save_load ____________
tests/unit/test_temporal_anomaly_detector.py:325: in test_hybrid_save_load
    assert new_detector.ml_detector.is_trained
E   assert False
E    +  where False = <src.analytics.temporal_anomaly_detector.LSTMTemporalDetector object at 0x7f800c2ee630>.is_trained
E    +    where <src.analytics.temporal_anomaly_detector.LSTMTemporalDetector object at 0x7f800c2ee630> = <src.analytics.temporal_anomaly_detector.HybridTemporalAnomalyDetector object at 0x7f800fab2b40>.ml_detector
------------------------------ Captured log call -------------------------------
WARNING  absl:saving_api.py:83 You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`.
=============================== warnings summary ===============================
tests/integration/test_chaos_scenarios.py:571
  /mnt/c/Users/alexf/OneDrive/Documents/Projects/Apple Health Exports/tests/integration/test_chaos_scenarios.py:571: PytestUnknownMarkWarning: Unknown pytest.mark.chaos - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytestmark = pytest.mark.chaos

tests/unit/test_temporal_anomaly_detector.py::TestLSTMTemporalDetector::test_lstm_detection
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_with_ml
tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_save_load
  /home/alexf/claude-env/lib/python3.12/site-packages/keras/src/layers/rnn/rnn.py:199: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
    super().__init__(**kwargs)

tests/unit/test_temporal_anomaly_detector.py::TestTemporalAnomalyIntegration::test_integration_with_ensemble
  /mnt/c/Users/alexf/OneDrive/Documents/Projects/Apple Health Exports/tests/unit/test_temporal_anomaly_detector.py:377: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
    data[50] += 30  # Add anomaly

tests/unit/test_temporal_anomaly_detector.py::TestTemporalAnomalyIntegration::test_integration_with_ensemble
  /mnt/c/Users/alexf/OneDrive/Documents/Projects/Apple Health Exports/tests/unit/test_temporal_anomaly_detector.py:377: FutureWarning: Series.__setitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To set a value by position, use `ser.iloc[pos] = value`
    data[50] += 30  # Add anomaly

tests/unit/test_temporal_anomaly_detector.py: 26 warnings
  /home/alexf/claude-env/lib/python3.12/site-packages/keras/src/backend/tensorflow/core.py:171: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments.
    return np.array(x)

tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_save_load
  /mnt/c/Users/alexf/OneDrive/Documents/Projects/Apple Health Exports/src/analytics/temporal_anomaly_detector.py:630: UserWarning: Could not load ML model: Could not locate function 'mse'. Make sure custom classes are decorated with `@keras.saving.register_keras_serializable()`. Full object config: {'module': 'keras.metrics', 'class_name': 'function', 'config': 'mse', 'registered_name': 'mse'}
    warnings.warn(f"Could not load ML model: {e}")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/unit/test_temporal_anomaly_detector.py::TestHybridTemporalAnomalyDetector::test_hybrid_save_load
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============ 1 failed, 91 passed, 33 warnings in 129.72s (0:02:09) =============
